<!-----コピペ：https://qiita.com/miyataku/items/a65bf6eb6fd8ce8593a9------->
<!DOCTYPE html>
<html lang="jp">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<title>twemojiでデコるやつ</title>
	<script src="./jquery-2.2.4-min.js"></script>
	<!--- <script src="./fabric.js"></script> --->
	<!--- <link rel="stylesheet" href="6_css分離.css"> --->
	<link rel="stylesheet" href="6_css.css">

	<!----CSS　■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■------------>
	<style></style>
	</head>

	<!-----HTML　■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■---->
	<body>
	<div class="content">
		<h5>twemojiでデコるやつ</h5>
		<p>画像ファイルから読み込み 0714</p>
		<div id="drop-zone">
			<p>ファイルをドラッグ＆ドロップ</p><p>もしくはファイルを選択</p>
			<input type="file" name="file" id="file-input">
		</div>
		<p>画像をレイヤーとして追加</p>
		<input type="file" name="add-file" id="add-file-input">
		<p>ねこ</p>
		<!---モーダル　絵文字リスト--->
		<div id="list_modal" class="list_modal">
			<button value="1f63a" class="emoji_button" type="button"><img src="twemoji_assets/png/1f63a.png"></button>
			<button value="1f63b" class="emoji_button" type="button"><img src="twemoji_assets/png/1f63b.png"></button>
			<button value="1f63c" class="emoji_button" type="button"><img src="twemoji_assets/png/1f63c.png"></button>
			<button value="1f63d" class="emoji_button" type="button"><img src="twemoji_assets/png/1f63d.png"></button>
			<button value="1f63e" class="emoji_button" type="button"><img src="twemoji_assets/png/1f63e.png"></button>
			<button value="1f63f" class="emoji_button" type="button"><img src="twemoji_assets/png/1f63f.png"></button>
			<button value="1f638" class="emoji_button" type="button"><img src="twemoji_assets/png/1f638.png"></button>
			<button value="1f639" class="emoji_button" type="button"><img src="twemoji_assets/png/1f639.png"></button>
			<button value="1f640" class="emoji_button" type="button"><img src="twemoji_assets/png/1f640.png"></button>
		</div>
		<button id="emoji_modal_button" type="button">他の絵文字</button>

		<!--- <button id="add_emoji" type="button">kiss</button> --->
		<div id="output">
			<h5>読み出し結果</h5>
			<div id="output_sub1" class="output_sub1">
				<canvas id="ctx_base" class="" width ="40" height="60" style="z-index: -2;"></canvas>
				<canvas id="ctx" class="ctx" width ="40" height="60" style="z-index: -1;"></canvas>
				<canvas id="flame" class="falme" width ="40" height="60" style="z-index: 0;"></canvas>
			</div>
			<div id="select">
				<select id="select_list" size="5">
					<option disabled selected>▼操作するレイヤーを選んでください▼</option>
				</select>
			</div>
			<button id="select_list_button" type="button">レイヤー切り替え</button>
			<button id="layer_del" type="button">レイヤー削除</button><br>
			<button id="download_image" type="button">保存</button><br>
			------------------------------<br>
			回転：<input type="range" name="angle" id="angle" min="-180" max="180"><div id="angle_num"></div>
			------------------------------<br>
			サイズ：<input type="range" name="size" id="size" min="-100" max="2000"><div id="size_num"></div>
			------------------------------<br>
		</div>
		<div id="LayerSelectCanvas">
		</div>
		<canvas id="download_canvas"></canvas>
		<br>
		---------------------------------<br>
		Copyright 2019 Twitter, Inc and other contributors<br>
		Code licensed under the MIT License: <a href="http://opensource.org/licenses/MIT">http://opensource.org/licenses/MIT</a><br>
		Graphics licensed under CC-BY 4.0: <a href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a><br>
		</div>
		<div id="Overlay1">
			<div id="mordal">
				<p>右クリックや長押しで画像を保存するのです</p>
				<img id="download_canvas_image" src=""><br>
				<button id="close" type="button">閉じる</button>
			</div>
		</div>
		<div id="Overlay2">
			<div id="emoji_modal" class="emoji_modal">
				<button value="1f4aa" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f4aa.png"></button>
				<button value="1f3c3" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f3c3.png"></button>
				<button value="1f3c3-200d-2642-fe0f" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f3c3-200d-2642-fe0f.png"></button>
				<button value="1f3c7" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f3c7.png"></button>
				<button value="1f6b4" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f6b4.png"></button>
				<button value="1f6b6" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f6b6.png"></button>
				<button value="1f6b6-200d-2642-fe0f" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f6b6-200d-2642-fe0f.png"></button>
				<button value="1f9a1" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f9a1.png"></button>
				<button value="1f9a2" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f9a2.png"></button>
				<button value="1f9a3" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f9a3.png"></button>
				<button value="1f9a4" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f9a4.png"></button>
				<button value="1f9a5" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f9a5.png"></button>
				<button value="1f9a6" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f9a6.png"></button>
				<button value="1f9a7" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f9a7.png"></button>
				<button value="1f9a8" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f9a8.png"></button>
				<button value="1f9a9" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f9a9.png"></button>
				<button value="1f9b5" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f9b5.png"></button>
				<button value="1f9cd" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f9cd.png"></button>
				<button value="1f9ce-1f3fc" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f9ce-1f3fc.png"></button>
				<button value="1f9d8" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f9d8.png"></button>
				<button value="1f9dc-200d-2642-fe0f" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f9dc-200d-2642-fe0f.png"></button>
				<button value="1f30e" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f30e.png"></button>
				<button value="1f32e" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f32e.png"></button>
				<button value="1f37a" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f37a.png"></button>
				<button value="1f37b" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f37b.png"></button>
				<button value="1f37e" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f37e.png"></button>
				<button value="1f40a" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f40a.png"></button>
				<button value="1f40b" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f40b.png"></button>
				<button value="1f40c" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f40c.png"></button>
				<button value="1f40d" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f40d.png"></button>
				<button value="1f40e" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f40e.png"></button>
				<button value="1f40f" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f40f.png"></button>
				<button value="1f41a" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f41a.png"></button>
				<button value="1f41b" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f41b.png"></button>
				<button value="1f41c" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f41c.png"></button>
				<button value="1f41d" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f41d.png"></button>
				<button value="1f41e" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f41e.png"></button>
				<button value="1f41f" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f41f.png"></button>
				<button value="1f42a" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f42a.png"></button>
				<button value="1f42b" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f42b.png"></button>
				<button value="1f42c" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f42c.png"></button>
				<button value="1f42d" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f42d.png"></button>
				<button value="1f42e" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f42e.png"></button>
				<button value="1f42f" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f42f.png"></button>
				<button value="1f43a" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f43a.png"></button>
				<button value="1f43b" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f43b.png"></button>
				<button value="1f43c" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f43c.png"></button>
				<button value="1f43d" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f43d.png"></button>
				<button value="1f43e" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f43e.png"></button>
				<button value="1f43f" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f43f.png"></button>
				<button value="1f44a" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f44a.png"></button>
				<button value="1f44b" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f44b.png"></button>
				<button value="1f44c" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f44c.png"></button>
				<button value="1f44d" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f44d.png"></button>
				<button value="1f44e" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f44e.png"></button>
				<button value="1f44f" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f44f.png"></button>
				<button value="1f57a" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f57a.png"></button>
				<button value="1f64c" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f64c.png"></button>
				<button value="1f64f" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f64f.png"></button>
				<button value="1f90c" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f90c.png"></button>
				<button value="1f90f" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f90f.png"></button>
				<button value="1f91a" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f91a.png"></button>
				<button value="1f91b" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f91b.png"></button>
				<button value="1f91c" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f91c.png"></button>
				<button value="1f91d" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f91d.png"></button>
				<button value="1f91e" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f91e.png"></button>
				<button value="1f91f" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f91f.png"></button>
				<button value="1f357" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f357.png"></button>
				<button value="1f361" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f361.png"></button>
				<button value="1f366" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f366.png"></button>
				<button value="1f369" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f369.png"></button>
				<button value="1f400" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f400.png"></button>
				<button value="1f401" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f401.png"></button>
				<button value="1f402" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f402.png"></button>
				<button value="1f403" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f403.png"></button>
				<button value="1f404" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f404.png"></button>
				<button value="1f405" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f405.png"></button>
				<button value="1f406" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f406.png"></button>
				<button value="1f407" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f407.png"></button>
				<button value="1f408" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f408.png"></button>
				<button value="1f408-200d-2b1b" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f408-200d-2b1b.png"></button>
				<button value="1f409" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f409.png"></button>
				<button value="1f410" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f410.png"></button>
				<button value="1f411" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f411.png"></button>
				<button value="1f412" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f412.png"></button>
				<button value="1f413" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f413.png"></button>
				<button value="1f414" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f414.png"></button>
				<button value="1f415" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f415.png"></button>
				<button value="1f416" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f416.png"></button>
				<button value="1f417" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f417.png"></button>
				<button value="1f418" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f418.png"></button>
				<button value="1f419" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f419.png"></button>
				<button value="1f420" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f420.png"></button>
				<button value="1f421" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f421.png"></button>
				<button value="1f422" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f422.png"></button>
				<button value="1f423" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f423.png"></button>
				<button value="1f424" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f424.png"></button>
				<button value="1f425" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f425.png"></button>
				<button value="1f426" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f426.png"></button>
				<button value="1f427" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f427.png"></button>
				<button value="1f428" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f428.png"></button>
				<button value="1f429" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f429.png"></button>
				<button value="1f430" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f430.png"></button>
				<button value="1f431" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f431.png"></button>
				<button value="1f432" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f432.png"></button>
				<button value="1f433" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f433.png"></button>
				<button value="1f434" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f434.png"></button>
				<button value="1f435" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f435.png"></button>
				<button value="1f436" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f436.png"></button>
				<button value="1f437" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f437.png"></button>
				<button value="1f438" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f438.png"></button>
				<button value="1f439" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f439.png"></button>
				<button value="1f446" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f446.png"></button>
				<button value="1f447" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f447.png"></button>
				<button value="1f448" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f448.png"></button>
				<button value="1f449" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f449.png"></button>
				<button value="1f450" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f450.png"></button>
				<button value="1f574" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f574.png"></button>
				<button value="1f590" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f590.png"></button>
				<button value="1f595" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f595.png"></button>
				<button value="1f596" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f596.png"></button>
				<button value="1f918" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f918.png"></button>
				<button value="1f919" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f919.png"></button>
				<button value="1f933" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f933.png"></button>
				<button value="1f932" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f932.png"></button>
				<button value="1f938" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f938.png"></button>
				<button value="1f938-1f3fc-200d-2642-fe0f" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f938-1f3fc-200d-2642-fe0f.png"></button>
				<button value="1f959" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f959.png"></button>
				<button value="1f988" class="emoji_button2" type="button"><img src="twemoji_assets/png/1f988.png"></button>
				<br><button id="close2" type="button">閉じる</button>
			</div>
		</div>
	</body>
</html>




<!-----javascript　■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■---->
<script language="javascript" type="text/javascript">
	//共通部分------------------------------------------------------------------------------------------
	//var canvasElement = document.getElementById("ctx");
	var ctxElement = document.getElementById("ctx");
	//var canvas = canvasElement.getContext("2d");
	var ctx = ctxElement.getContext("2d");
	var flame = document.getElementById("flame");
	var download_canvas = document.getElementById(`download_canvas`);
	var base_img= new Image();
	//var add_img= new Image();
	let count = 0;
	var imageData = new ImageData(100,100);
	var download_img = new Image();
	var add_img = new Image();
	var baseX = 0;
	var baseY = 0;
	var c0width =0;
	var c0height =0;
	var AddCanvasArray=[]; //キャンバス情報を配列に保存してみる
		var x, y, relX, relY;
		var startX, startY, endX, endY;
		var startX_1, startY_1, endX_1, endY_1;
		var startX_2, startY_2, endX_2, endY_2;
		var startC;
		var transX,transY,sizeX,sizeY;
		var objX_1, objY_1,objX_2, objY_2;
		var objWidth, objHeight;
		var dragging = false;
		var pinch = false;
		var angle =0;
		var size =0;
		var zoom = 1;
		var LayerSelect = "null";
	//var baseCanvas = document.getElementById("ctx_base");
	//var base_ctx = baseCanvas.getContext("2d");
	//var selectCanvas
	//var sc_ctx
	flg=[];
	offsetX=0;
	offsetY=0;

	// 指定ミリ秒間だけループさせる（CPUは常にビジー状態）---------------------------------------
	function sleep(waitMsec) {
		var startMsec = new Date();
		while (new Date() - startMsec < waitMsec);
	}


	function drawRect() {
			//console.log("描画")
			if(ctx.width == null){
					//console.log(ctx.width, ctx.height)
					ctxElement.getContext("2d").clearRect(0, 0,40, 60);
			}
			ctxElement.getContext("2d").clearRect(0, 0, ctx.width, ctx.height)  // キャンバスをクリア
			flame.getContext("2d").clearRect(0, 0, flame.width, flame.height)  // キャンバスをクリア

			//背景画像を読み込む
			ctxElement.getContext("2d").drawImage(base_img,0,0);

			AddCanvasArray.forEach(function(canvas){
					//console.log(canvas);
					//console.log(canvas.id);
					//download_img.src = canvas.toDataURL(`image/png`);
					if(canvas.id !== `ctx` && canvas.id !== `ctx_base` ){
						//var canvas_num = Number(canvas.id.slice(7))+1;
						if(canvas[2] !== "" ){
							transX = canvas[3]+canvas[6]/2;  //*AddCanvasArray[LayerSelect][8]/2;
							transY = canvas[4]+canvas[7]/2; //*AddCanvasArray[LayerSelect][8]/2;
							sizeX = canvas[6]*canvas[8];
							sizeY = canvas[7]*canvas[8];
							//参考：AddCanvasArray[count]=[count,ctx_add,imageData,0,0,0]; //キャンバス情報を配列に保存してみる(0:No , 1:canvas , 2:画像 , 3;baseX , 4:baseY , 5:angle);
							//中心を移動　AddCanvasArray[LayerSelect][2].width , AddCanvasArray[LayerSelect][2].height
							ctxElement.getContext("2d").translate( transX , transY ); //中心を移動
							ctxElement.getContext("2d").rotate(canvas[5]); //回転
							ctxElement.getContext("2d").drawImage(canvas[2],-sizeX/2,-sizeY/2,sizeX,sizeY); //,AddCanvasArray[LayerSelect][1].width,AddCanvasArray[LayerSelect][1].height) ;　//描画

							if(canvas[0] == LayerSelect){//枠線つける
									//console.log("枠線")
									flame.getContext("2d").translate( transX , transY ); //中心を移動
									flame.getContext("2d").rotate(canvas[5]); //回転
										flame.getContext("2d").beginPath();
										flame.getContext("2d").rect( -sizeX/2,-sizeY/2,sizeX,sizeY);
										flame.getContext("2d").strokeStyle ="red";
										flame.getContext("2d").lineWidth = 1*zoom;
										flame.getContext("2d").stroke();
									flame.getContext("2d").rotate(-canvas[5]); //回転
									flame.getContext("2d").translate( -transX , -transY);//中心を復元
							}
							ctxElement.getContext("2d").rotate(-canvas[5]); //回転
							ctxElement.getContext("2d").translate( -transX , -transY);//中心を復元
						}
					}
	　　})
	}

	function onDown(e) {
			e.preventDefault();
			// キャンバスの左上端の座標を取得
			offsetX = flame.getBoundingClientRect().left;
			offsetY = flame.getBoundingClientRect().top;
			// マウスが押された座標を取得
			startX = e.clientX - offsetX;
			startY = e.clientY - offsetY;
			console.log("クリック",startX,startY)
			// オブジェクト上の座標かどうかを判定
			if (offsetX < startX+offsetX && (offsetX + objWidth) > startX+offsetX && offsetY <startY+offsetY && (offsetY + objHeight) > startY+offsetY) {
				dragging = true; // ドラッグ開始
			}
	}
	function onDown_sp(e) {
		e.preventDefault();
		//console.log("指の本数",e.touches.length)
		if(e.touches.length === 1){
				// キャンバスの左上端の座標を取得
				offsetX = flame.getBoundingClientRect().left;
				offsetY = flame.getBoundingClientRect().top;
				// マウスが押された座標を取得
				startX_1 = e.touches[0].clientX - offsetX;
				startY_1 = e.touches[0].clientY - offsetY;
				// オブジェクト上の座標かどうかを判定
				if (offsetX < startX_1+offsetX && (offsetX + objWidth) > startX_1+offsetX
						&& offsetY <startY_1+offsetY && (offsetY + objHeight) > startY_1+offsetY) {
					dragging = true; // ドラッグ開始
				}
		}else if(e.touches.length === 2){　//ピンチ操作
				// キャンバスの左上端の座標を取得
				offsetX = flame.getBoundingClientRect().left;
				offsetY = flame.getBoundingClientRect().top;
				// マウスが押された座標を取得
				startX_1 = e.touches[0].clientX - offsetX;
				startY_1 = e.touches[0].clientY - offsetY;
				startX_2 = e.touches[1].clientX - offsetX;
				startY_2 = e.touches[1].clientY - offsetY;
				startC =  AddCanvasArray[LayerSelect][5] ;
				// オブジェクト上の座標かどうかを判定
				if (offsetX < startX_1+offsetX && (offsetX + objWidth) > startX_1+offsetX
						&& offsetY <startY_1+offsetY && (offsetY + objHeight) > startY_1+offsetY
						&& offsetX < startX_2+offsetX && (offsetX + objWidth) > startX_2+offsetX
						&& offsetY <startY_2+offsetY && (offsetY + objHeight) > startY_2+offsetY) {
					pinch = true; // ピンチ開始
				}
		}else{
			dragging = false;
			pinch = false;
		}
	}
	//ドラッグ・ドロップ
	function onMove(e) {
		e.preventDefault();
		// マウスが移動した先の座標を取得
		endX = e.clientX - offsetX;
		endY = e.clientY - offsetY;
		// ドラッグが開始されていればオブジェクトの座標を更新して再描画
		if (dragging) {
			//console.log(LayerSelect,"ドラッグ中");
			objX = endX - startX;
			objY = endY - startY;
			AddCanvasArray[LayerSelect][3] = AddCanvasArray[LayerSelect][3] + objX*zoom;
			AddCanvasArray[LayerSelect][4] = AddCanvasArray[LayerSelect][4] + objY*zoom;
			//requestAnimationFrame(drawRect);
			drawRect();
			startX = endX;
			startY = endY;
		}
	}
	function onMove_sp(e) {
		e.preventDefault();
		// ドラッグが開始されていればオブジェクトの座標を更新して再描画
		if (dragging) {
			endX_1 = e.touches[0].clientX - offsetX;
			endY_1 = e.touches[0].clientY - offsetY;
			//console.log("始点",`左上：${offsetX} / クリック：${startX+offsetX} / 右端：${offsetX+objWidth},左上：${offsetY} / クリック：${startY+offsetY} / 下端：${offsetY+objHeight}`,dragging);
			objX_1 = endX_1 - startX_1;
			objY_1 = endY_1 - startY_1;
			AddCanvasArray[LayerSelect][3] = AddCanvasArray[LayerSelect][3] + objX_1*zoom;
			AddCanvasArray[LayerSelect][4] = AddCanvasArray[LayerSelect][4] + objY_1*zoom;
			//requestAnimationFrame(drawRect);
			drawRect();
			startX_1 = endX_1;
			startY_1 = endY_1;
		}
		if(pinch){
			dragging = false;
			endX_1 = e.touches[0].clientX - offsetX;
			endY_1 = e.touches[0].clientY - offsetY;
			endX_2 = e.touches[1].clientX - offsetX;
			endY_2 = e.touches[1].clientY - offsetY;
			//サイズ計算
			var startV = Math.sqrt((startX_2-startX_1)**2+(startY_2-startY_1)**2);
			var endV =  Math.sqrt((endX_2-endX_1)**2+(endY_2-endY_1)**2);
			AddCanvasArray[LayerSelect][8] = AddCanvasArray[LayerSelect][8] *endV/startV
			if(AddCanvasArray[LayerSelect][8] <= 0.1){AddCanvasArray[LayerSelect][8]=0.1}
			if(AddCanvasArray[LayerSelect][8] >= 20){AddCanvasArray[LayerSelect][8]=20}
			//座標計算
			var startC_X = (startX_2+startX_1)/2
			var endC_X = (endX_2+endX_1)/2
			var startC_Y = (startY_2+startY_1)/2
			var endC_Y = (endY_2+endY_1)/2
			objX_2=endC_X-startC_X
			objY_2=endC_Y-startC_Y
			AddCanvasArray[LayerSelect][3] = AddCanvasArray[LayerSelect][3] + objX_2*zoom;
			AddCanvasArray[LayerSelect][4] = AddCanvasArray[LayerSelect][4] + objY_2*zoom;
			//回転
			if((startC/Math.PI*180 + e.rotation)%360 <= 180 && -180 < (startC/Math.PI*180 + e.rotation)%360 ){
				AddCanvasArray[LayerSelect][5] = (startC + ((e.rotation%360)/180 *Math.PI));
			}else if((startC/Math.PI*180 + e.rotation)%360 > 180){
				AddCanvasArray[LayerSelect][5] = (startC + e.rotation/180*Math.PI)%(2*Math.PI) -2*Math.PI;
			}else{
				AddCanvasArray[LayerSelect][5] = (startC + e.rotation/180*Math.PI)%(2*Math.PI) +2*Math.PI;
			}
			//描画
			//requestAnimationFrame(drawRect);
			drawRect();

			startX_1 = endX_1;
			startY_1 = endY_1;
			startX_2 = endX_2;
			startY_2 = endY_2;
			document.getElementById("angle").value = AddCanvasArray[LayerSelect][5] / Math.PI *180 ;
			document.getElementById(`angle_num`).innerText = `${document.getElementById("angle").value}度/rotation値：${e.rotation}`;
			document.getElementById("size").value = (AddCanvasArray[LayerSelect][8]-1)*100 ;
			document.getElementById(`size_num`).innerText = `${document.getElementById("size").value}%`;
		}
	}
	function onUp(e) {
		e.preventDefault();
		dragging = false; // ドラッグ終了
		//console.log("終点",endX,endY)
	}
	function onUp_sp(e) {
		e.preventDefault();
		dragging = false; // ドラッグ終了
		pinch = false;
		//console.log("終点",endX,endY)
	}


	//ファイルアップロード対応用--------------------------------------------------------------------------
	//ベース画像ファイルの選択・処理部分------------------------------------------------------------------
	//fileInputのinputタグで更新があったら
	document.getElementById("file-input").addEventListener('change', (e) => {
		let files = e.target.files;
		//fileInputからファイルが取得できたら
		if (files.length > 0) {
			//imgオブジェクトにURL形式に変換して代入
			base_img.src = URL.createObjectURL(files[0]);
			//imgオブジェクトで上記の画像が読み込みが終わったら
			base_img.onload = function() {
				//canvasのサイズを変更して画像を書き写します.
				ctxElement.width = base_img.width;
				ctxElement.height = base_img.height;
				flame.width = base_img.width;
				flame.height = base_img.height;
				//ctx.setAttribute("width",ctxElement.width);
				//ctx.setAttribute("height",ctxElement.height);
				//flame.setAttribute("width",ctxElement.width);
				//flame.setAttribute("height",ctxElement.height);
				ctx.drawImage(base_img, 0, 0, ctxElement.width, ctxElement.height);
				zoom = ctxElement.width / ctxElement.clientWidth; //倍率の表示
				URL.revokeObjectURL(base_img);
				//base_img = null;

				// キャンバスの左上端の座標を取得
				offsetX = flame.getBoundingClientRect().left;
				offsetY = flame.getBoundingClientRect().top;
				console.log(offsetX,objWidth);
							// オブジェクト上の座標かどうかを判定
							//if (offsetX < startX_1+offsetX && (offsetX + objWidth) > startX_1+offsetX
							//		&& offsetY <startY_1+offsetY && (offsetY + objHeight) > startY_1+offsetY) {
							//	dragging = true; // ドラッグ開始
							//}

				try{
					//console.log("イベントリスナーのリセット");
					flame.removeEventListener('mousedown', onDown)//, false);
					flame.removeEventListener('mousemove', onMove)//, false);
					flame.removeEventListener('mouseup', onUp)//, false);
					flame.removeEventListener('touchstart', onDown_sp)//, false);
					flame.removeEventListener('touchmove', onMove_sp)//, false);
					flame.removeEventListener('touchend', onUp_sp)//, false);
				}catch(e){}finally{}

				console.log("set")
				flame.addEventListener('mousedown', onDown)//, false);
				flame.addEventListener('mousemove', onMove)//, false);
				flame.addEventListener('mouseup', onUp)//, false);
				flame.addEventListener('touchstart', onDown_sp)//, false);
				flame.addEventListener('touchmove', onMove_sp)//, false);
				flame.addEventListener('touchend', onUp_sp)//, false);

		};
		document.getElementById("file-input").value = '';
		files = null;
		}
	}, false);

	//レイヤーとしてCanvasを生成する部分----------------------------------------------------------
	(()=>{
		const layerCanvas = function ( id , width , height ) {
			const wrap = document.getElementById("output_sub1");
			var ctxElement = document.getElementById("ctx");
			return {
				addCanvas:() => {
					const cvs = document.createElement("canvas");
					cvs.setAttribute("id" , "canvas_" + count );
					cvs.classList.add("canvas");
					cvs.setAttribute("width",ctxElement.width);
					cvs.setAttribute("height",ctxElement.height);
					cvs.style.zIndex = count;
					wrap.appendChild( cvs );
					//count ++;
					return cvs;
				}
			};
		};

		//■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
		//追加画像ファイルの選択・処理部分------------------------------------------------------------------
		//■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
		window.addEventListener( "DOMContentLoaded" , ()=> {
			const lcv = layerCanvas("output_sub1",ctxElement.width,ctxElement.height);
			//let count=0;

			//fileInputのinputタグで更新があったら
			document.getElementById("add-file-input").addEventListener('change', (e) => {
				let files = e.target.files;

				//fileInputからファイルが取得できたら
				if (files.length > 0) {
					var add_img= new Image();
					//imgオブジェクトにURL形式に変換して代入
					add_img.src = URL.createObjectURL(files[0]);

					//imgオブジェクトで上記の画像が読み込みが終わったら
					add_img.onload = function() {

						AddCanvasArray[count]=[count,ctx,add_img,0,0,0,add_img.width,add_img.height,1]; //キャンバス情報を配列に保存してみる(No,canvas,画像,baseX,baseY,angle,width,height,size);

						requestAnimationFrame(drawRect); //drawRect();


								count ++;
								LayerSelect_sub = count-1;

								var add_list = document.createElement("option");
								add_list.value =LayerSelect_sub;
								add_list.innerText =`canvas_${LayerSelect_sub}`;
								document.getElementById("select_list").appendChild(add_list);

								//flg立てる
								//if(flg.length != 0){flg.fill(0);}
								//flg[LayerSelect_sub-1] = 1;
								document.getElementById("select_list").selectedIndex = document.getElementById("select_list").children.length-1
								//console.log(document.getElementById("select_list").children);
								LayerSelect_sub = document.getElementById("select_list").children[document.getElementById("select_list").selectedIndex].value
								list_serection();
						//imageData = ctx_add.getImageData(0,0,ctx_add.width, ctx_add.height);
						URL.revokeObjectURL(add_img);

						files = null;
						add_img = null;
					}
				}

				document.getElementById("add-file-input").value = '';
			}, false);
		});
	//})();

		//■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
		//絵文字追加処理部分------------------------------------------------------------------
		//■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
		window.addEventListener( "DOMContentLoaded" , ()=> {
			const lcv = layerCanvas("output_sub1",ctxElement.width,ctxElement.height);

			//絵文字ボタンパ^と■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
			var emoji_buttons = Array.from(document.getElementsByClassName("emoji_button")).concat(Array.from(document.getElementsByClassName("emoji_button2")));
			emoji_buttons.forEach(function(emoji_button){
				emoji_button.addEventListener('click', (e) => {
					e.preventDefault();
					var add_img= new Image();
					//imgオブジェクトにURL形式に変換して代入
					add_img.src = `twemoji_assets/svg/${emoji_button.value}.svg`

					//imgオブジェクトで上記の画像が読み込みが終わったら
					add_img.onload = function() {
							add_img.width=100*zoom;
							add_img.height=100*zoom;
						/*
						ctx_add.drawImage(add_img, 0 , 0 );  //count * 10, count * 10); //, ctx_add.width, ctx_add.height);
						*/
						AddCanvasArray[count]=[count,ctx,add_img,0,0,0,add_img.width,add_img.height,1]; //キャンバス情報を配列に保存してみる(No,canvas,画像,baseX,baseY,angle,width,height,size);

						requestAnimationFrame(drawRect); //drawRect();

							  count ++;
								LayerSelect_sub = count-1;

								var add_list = document.createElement("option");
								add_list.value =LayerSelect_sub;
								add_list.innerText =`canvas_${LayerSelect_sub}`;
								document.getElementById("select_list").appendChild(add_list);

								//flg立てる
								//if(flg.length != 0){flg.fill(0);}
								//flg[LayerSelect_sub-1] = 1;
								document.getElementById("select_list").selectedIndex = document.getElementById("select_list").children.length-1
								//console.log(document.getElementById("select_list").children);
								LayerSelect_sub = document.getElementById("select_list").children[document.getElementById("select_list").selectedIndex].value
								list_serection();
						//imageData = ctx_add.getImageData(0,0,ctx_add.width, ctx_add.height);
						URL.revokeObjectURL(add_img);

						files = null;
						add_img = null;
						}
						document.getElementById('Overlay2').style.display = "none" ;
					}, false);
				});
		});

	})();


	//■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
	//　追加したレイヤーを操作可能にする部分
	//■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
	// (変更を監視する) オブザーバーのオプション
	const config1 = { childList: true };

	// オブザーバインスタンスを作成　※画像追加の検知
	const observer1 = new MutationObserver((mutations) => {
		mutations.forEach((mutation) => {
		        // 何かしたいこと
			LayerSelect_sub = count;
			if(LayerSelect="null"){ LayerSelect = count }
			//console.log(`画像追加検知：${LayerSelect_sub}`);
			document.getElementById(`LayerSelectCanvas`).value = `canvas_${LayerSelect_sub-1}`;
			document.getElementById(`LayerSelectCanvas`).innerText = `canvas_${LayerSelect_sub-1}`;
			document.getElementById(`LayerSelectCanvas`).nodeValue = `canvas_${LayerSelect_sub-1}`;
			document.getElementById(`LayerSelectCanvas`).textContent = `canvas_${LayerSelect_sub-1}`;

			var add_list = document.createElement("option");
			add_list.value =LayerSelect_sub;
			add_list.innerText =`canvas_${LayerSelect_sub-1}`;
			document.getElementById("select_list").appendChild(add_list);

			//flg立てる
			//if(flg.length != 0){flg.fill(0);}
			//flg[LayerSelect_sub-1] = 1;
			document.getElementById("select_list").selectedIndex = document.getElementById("select_list").children.length-1
			//console.log(document.getElementById("select_list").children);
			LayerSelect_sub = document.getElementById("select_list").children[document.getElementById("select_list").selectedIndex].value
			list_serection();


		});
	});

	// 対象ノードとオブザーバの設定を渡す
	observer1.observe(document.getElementById('output_sub1') , config1);



	//■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
	// (変更を監視する) オブザーバーのオプション
	const config2 = { attributes: true, childList: true, characterData: true  , subtree: true };

	// オブザーバインスタンスを作成　※切り替えボタンの検知
	const observer2 = new MutationObserver((mutations) => {
		mutations.forEach((mutation) => {

	        	// 何かしたいこと
			//console.log(`ボタン検知：${LayerSelect_sub}`);
			/*
			try{
				//console.log("イベントリスナーのリセット");

				flame.removeEventListener('mousedown', onDown)//, false);
				flame.removeEventListener('mousemove', onMove)//, false);
				flame.removeEventListener('mouseup', onUp)//, false);

				flame.removeEventListener('touchstart', onDown_sp)//, false);
				flame.removeEventListener('touchmove', onMove_sp)//, false);
				flame.removeEventListener('touchend', onUp_sp)//, false);

			}catch(e){}finally{}
			*/

			LayerSelect = LayerSelect_sub;

			//座標計算
			objWidth =  document.getElementById(`ctx`).width/zoom;
			objHeight = document.getElementById(`ctx`).height/zoom;
			//console.log(selectCanvas.width,selectCanvas.height);
			objX = ctxElement.width / 2 - objWidth / 2;
			objY = ctxElement.height / 2 - objHeight / 2;

			//console.log(flg[LayerSelect -1])
			//console.log(flg)
			//if(flg[LayerSelect-1] != 0 ){

			//};
			requestAnimationFrame(drawRect); //drawRect();
		});
	});


	// 対象ノードとオブザーバの設定を渡す
	observer2.observe(document.getElementById('LayerSelectCanvas') , config2);


	//■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
	//　選択レイヤーを回転させたい
	//■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■

	document.getElementById("angle").addEventListener( "change" ,() => {
					//console.log("slider操作",LayerSelect)
					var transX = AddCanvasArray[LayerSelect][2].width/2;
					var transY = AddCanvasArray[LayerSelect][2].height/2;
					angle = document.getElementById("angle").value
					AddCanvasArray[LayerSelect][5] = angle/180 *Math.PI ;

					requestAnimationFrame(drawRect); //drawRect();

					document.getElementById(`angle_num`).innerText = angle;
				});


	//■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
	//　選択レイヤーをサイズ調整したい
	//■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■

	document.getElementById("size").addEventListener( "change" ,() => {
			//console.log("slider操作",LayerSelect)
			angle = document.getElementById("angle").value
			AddCanvasArray[LayerSelect][5] = angle/180 *Math.PI ;
			size = 1 + document.getElementById("size").value/100;
			AddCanvasArray[LayerSelect][8] = size;

			requestAnimationFrame(drawRect); //drawRect();

			document.getElementById(`size_num`).innerText = `${size*100}%`;
		}
	);



	//■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
	//　選択したレイヤーを削除する部分
	//■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■

	document.getElementById("layer_del").addEventListener( "click" ,(e) => {
			e.preventDefault();
			//console.log("削除",LayerSelect)
			AddCanvasArray[LayerSelect].fill("");

			//document.getElementById(`canvas_${LayerSelect -1}`).getContext("2d").clearRect(0, 0, document.getElementById(`canvas_${LayerSelect -1}`).width, document.getElementById(`canvas_${LayerSelect -1}`).height)  // キャンバスをクリア
			var del_index =document.getElementById("select_list").selectedIndex;
			document.getElementById("select_list").removeChild(document.getElementById("select_list").children[del_index]);
			//console.log(`リスト長さ：${document.getElementById("select_list").childElementCount}・変更後のリスト:${del_index}`)

			if(document.getElementById("select_list").childElementCount <= 1){
				document.getElementById("select_list").selectedIndex = null;
				LayerSelect_sub = null;
			}else if(del_index>1){
				document.getElementById("select_list").selectedIndex = del_index-1;
				LayerSelect_sub = document.getElementById("select_list").children[document.getElementById("select_list").selectedIndex].value
			}else{
				document.getElementById("select_list").selectedIndex = del_index;
				LayerSelect_sub = document.getElementById("select_list").children[document.getElementById("select_list").selectedIndex].value
			}

			//console.log(LayerSelect_sub);
			list_serection();
		}
	);

	//■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
	//　ボタンでレイヤーを切り替える部分
	//■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■

	document.getElementById("select_list_button").addEventListener( "click" ,(e) => {
		console.log("切り替えボタン")
		e.preventDefault();
		//console.log(`document.getElementById("select_list").selectedIndex ${document.getElementById("select_list").selectedIndex}  document.getElementById("select_list").children.length ${document.getElementById("select_list").children.length}`)
		if(document.getElementById("select_list").selectedIndex !== null){
			if(document.getElementById("select_list").selectedIndex == document.getElementById("select_list").children.length-1){
				document.getElementById("select_list").selectedIndex = 1;
				console.log(`document.getElementById("select_list").selectedIndex == document.getElementById("select_list").children.length-1`);
			}else{
				document.getElementById("select_list").selectedIndex = document.getElementById("select_list").selectedIndex + 1;
			}
		//console.log(document.getElementById("select_list").children);
			LayerSelect_sub = document.getElementById("select_list").children[document.getElementById("select_list").selectedIndex].value
			list_serection();
		}else{
			console.log(`Select_list_button document.getElementById("select_list").selectedIndex !== null`);
		}
	});

	//■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
	//　リスト選択でレイヤーを切り替える部分
	//■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■

	//リスト選択時の挙動
	document.getElementById("select_list").addEventListener( "change" ,(e) => {
				//LayerSelect = 2;
				e.preventDefault();
				LayerSelect_sub = document.getElementById("select_list").children[document.getElementById("select_list").selectedIndex].value
				//console.log(LayerSelect_sub);
				list_serection();
			}
	);

	function list_serection(){
		//console.log("select_list：",document.getElementById("select_list").value);
		flg.fill(0);
		flg[LayerSelect_sub] = 1;

		//console.log(LayerSelect_sub,"操作開始");

		if(LayerSelect_sub === null){
			console.log("list_serection LayerSelect_sub === null");
			document.getElementById("angle").value = 0 ;
			document.getElementById(`angle_num`).innerText = 0;
			document.getElementById("size").value = 100 ;
			document.getElementById(`size_num`).innerText = `100%`;
			document.getElementById(`LayerSelectCanvas`).innerText = AddCanvasArray[LayerSelect_sub];
		}else{
			document.getElementById("angle").value = AddCanvasArray[LayerSelect_sub][5] / Math.PI *180 ;
			document.getElementById(`angle_num`).innerText = document.getElementById("angle").value;
			document.getElementById("size").value = (AddCanvasArray[LayerSelect_sub][8]-1)*100 ;
			document.getElementById(`size_num`).innerText = `${document.getElementById("size").value}%`;
			document.getElementById(`LayerSelectCanvas`).innerText = AddCanvasArray[LayerSelect_sub];
		}
	}


	//■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■
	//　canvasを統合してDLする部分
	//■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■

		document.getElementById("download_image").addEventListener( "click" ,() => {
			document.getElementById(`download_canvas_image`).src = ctxElement.toDataURL("image/png");
			document.getElementById('Overlay1').style.display = "block" ;
	});

//その他ボタン動作

	document.getElementById("close").addEventListener( "click" ,() => {
		document.getElementById('Overlay1').style.display = "none" ;
	});

	document.getElementById("emoji_modal_button").addEventListener( "click" ,() => {
		document.getElementById('Overlay2').style.display = "block" ;
	});
	document.getElementById("close2").addEventListener( "click" ,() => {
		document.getElementById('Overlay2').style.display = "none" ;
	});

	//拡大・回転への対応案（一旦角度・倍率？のパラメータを追加して、スライダーで調整してみる？倍率はいらないかも）
	//①2点タップを読み取る何かで対応（スマホ向け）
	//②枠の四隅をドラッグで拡大・縮小
	//　回転用のアイコンをドラッグで回転

</script>
